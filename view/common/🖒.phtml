<?php
/**
 * Like/Dislike buttons template.
 *
 * @var \Laminas\View\Renderer\PhpRenderer $this
 * @var \Omeka\Api\Representation\AbstractResourceEntityRepresentation $resource
 * @var \Omeka\Api\Representation\UserRepresentation|null $user
 * @var array $options
 * @var array $counts ('likes', 'dislikes', 'total')
 * @var bool|null $userLiked (null = not voted, true = liked, false = disliked)
 * @var string $toggleUrl
 * @var bool $isLoggedIn
 */

$plugins = $this->getHelperPluginManager();
$translate = $plugins->get('translate');
$escapeAttr = $plugins->get('escapeHtmlAttr');

$iconType = $options['iconType'] ?? 'unicode';
$iconShape = $options['iconShape'] ?? 'heart';
$showCountğŸ–’ = $options['showCountğŸ–’'] ?? true;
$showCountğŸ–“ = $options['showCountğŸ–“'] ?? false;
$allowğŸ–“ = $options['allowğŸ–“'] ?? true;

// Icons based on shape.
if ($iconShape === 'heart') {
    // Unicode heart characters.
    $iconUnicodeLike = 'â¤ï¸';
    $iconUnicodeDislike = 'ğŸ’”';
    // Font Awesome classes.
    $iconLikeFa = 'fa-heart';
    $iconDislikeFa = 'fa-heart-broken';
} else {
    // Unicode thumbs characters.
    $iconUnicodeLike = 'ğŸ–’';
    $iconUnicodeDislike = 'ğŸ–“';
    // Font Awesome classes.
    $iconLikeFa = 'fa-thumbs-up';
    $iconDislikeFa = 'fa-thumbs-down';
}

// Determine button states.
$likeActive = $userLiked === true ? 'active' : '';
$dislikeActive = $userLiked === false ? 'active' : '';

// Build login message based on icon shape and allow dislike.
if ($iconShape === 'heart') {
    $loginMessage = $allowğŸ–“
        ? $translate('You must be logged in to â¤ï¸ or ğŸ’” resources.')
        : $translate('You must be logged in to â¤ï¸ resources.');
} else {
    $loginMessage = $allowğŸ–“
        ? $translate('You must be logged in to ğŸ–’ or ğŸ–“ resources.')
        : $translate('You must be logged in to ğŸ–’ resources.');
}
?>

<div class="like-container" data-resource-id="<?= $resource->id() ?>" data-url-toggle="<?= $escapeAttr($toggleUrl) ?>" data-message-login="<?= $escapeAttr($loginMessage) ?>">
    <button type="button" class="like-button like-action <?= $likeActive ?>" data-action="like" data-liked="true" title="<?= $escapeAttr($translate('Like')) ?>" <?= !$isLoggedIn ? 'data-require-login="true"' : '' ?>>
        <?php if ($iconType === 'fa'): ?>
            <span class="fa <?= $iconLikeFa ?>"></span>
        <?php else: ?>
            <span class="like-icon"><?= $iconUnicodeLike ?></span>
        <?php endif; ?>
        <?php if ($showCountğŸ–’): ?>
            <span class="like-count"><?= (int) $counts['likes'] ?></span>
        <?php endif; ?>
    </button>
    <?php if ($allowğŸ–“): ?>
    <button type="button" class="like-button dislike-action <?= $dislikeActive ?>" data-action="dislike" data-liked="false" title="<?= $escapeAttr($translate('Dislike')) ?>" <?= !$isLoggedIn ? 'data-require-login="true"' : '' ?>>
        <?php if ($iconType === 'fa'): ?>
            <span class="fa <?= $iconDislikeFa ?>"></span>
        <?php else: ?>
            <span class="like-icon"><?= $iconUnicodeDislike ?></span>
        <?php endif; ?>
        <?php if ($showCountğŸ–“): ?>
            <span class="dislike-count"><?= (int) $counts['dislikes'] ?></span>
        <?php endif; ?>
    </button>
    <?php endif; ?>
</div>

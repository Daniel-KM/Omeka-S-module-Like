<?php
/**
 * Like/Dislike buttons template.
 *
 * @var \Laminas\View\Renderer\PhpRenderer $this
 * @var \Omeka\Api\Representation\AbstractResourceEntityRepresentation $resource
 * @var \Omeka\Api\Representation\UserRepresentation|null $user
 * @var array $options
 * @var array $counts ('likes', 'dislikes', 'total')
 * @var bool|null $userLiked (null = not voted, true = liked, false = disliked)
 * @var string $toggleUrl
 * @var bool $isLoggedIn
 */

$plugins = $this->getHelperPluginManager();
$translate = $plugins->get('translate');
$escapeAttr = $plugins->get('escapeHtmlAttr');

$iconType = $options['iconType'] ?? 'unicode';
$iconShape = $options['iconShape'] ?? 'heart';
$showCountğŸ–’ = $options['showCountğŸ–’'] ?? true;
$showCountğŸ–“ = $options['showCountğŸ–“'] ?? false;
$allowğŸ–“ = $options['allowğŸ–“'] ?? true;

// Icons based on shape.
switch ($iconShape) {
    case 'thumb':
        $iconUnicodeLike = 'ğŸ‘';
        $iconUnicodeDislike = 'ğŸ‘';
        $iconLikeFa = 'fa-thumbs-up';
        $iconDislikeFa = 'fa-thumbs-down';
        break;
    case 'reverse':
        $iconUnicodeLike = 'ğŸ–’';
        $iconUnicodeDislike = 'ğŸ–“';
        $iconLikeFa = 'fa-thumbs-up';
        $iconDislikeFa = 'fa-thumbs-down';
        break;
    case 'thumb-reverse':
        $iconUnicodeLike = 'ğŸ‘';
        $iconUnicodeDislike = 'ğŸ–“';
        $iconLikeFa = 'fa-thumbs-up';
        $iconDislikeFa = 'fa-thumbs-down';
        break;
    case 'reverse-thumb':
        $iconUnicodeLike = 'ğŸ–’';
        $iconUnicodeDislike = 'ğŸ‘';
        $iconLikeFa = 'fa-thumbs-up';
        $iconDislikeFa = 'fa-thumbs-down';
        break;
    case 'heart':
    default:
        $iconUnicodeLike = 'â¤ï¸';
        $iconUnicodeDislike = 'ğŸ’”';
        $iconLikeFa = 'fa-heart';
        $iconDislikeFa = 'fa-heart-broken';
        break;
}

// Determine button states.
$likeActive = $userLiked === true ? 'active' : '';
$dislikeActive = $userLiked === false ? 'active' : '';

// Build login message based on icons.
if ($allowğŸ–“) {
    $loginMessage = $translate('You must be logged in to %1$s or %2$s resources.');
    $loginMessage = sprintf($loginMessage, $iconUnicodeLike, $iconUnicodeDislike);
} else {
    $loginMessage = $translate('You must be logged in to %s resources.');
    $loginMessage = sprintf($loginMessage, $iconUnicodeLike);
}
?>

<div class="like-container" data-resource-id="<?= $resource->id() ?>" data-url-toggle="<?= $escapeAttr($toggleUrl) ?>" data-message-login="<?= $escapeAttr($loginMessage) ?>">
    <button type="button" class="like-button like-action <?= $likeActive ?>" data-action="like" data-liked="true" title="<?= $escapeAttr($translate('Like')) ?>" <?= !$isLoggedIn ? 'data-require-login="true"' : '' ?>>
        <?php if ($iconType === 'fa'): ?>
            <span class="fa <?= $iconLikeFa ?>"></span>
        <?php else: ?>
            <span class="like-icon"><?= $iconUnicodeLike ?></span>
        <?php endif; ?>
        <?php if ($showCountğŸ–’): ?>
            <span class="like-count"><?= (int) $counts['likes'] ?></span>
        <?php endif; ?>
    </button>
    <?php if ($allowğŸ–“): ?>
    <button type="button" class="like-button dislike-action <?= $dislikeActive ?>" data-action="dislike" data-liked="false" title="<?= $escapeAttr($translate('Dislike')) ?>" <?= !$isLoggedIn ? 'data-require-login="true"' : '' ?>>
        <?php if ($iconType === 'fa'): ?>
            <span class="fa <?= $iconDislikeFa ?>"></span>
        <?php else: ?>
            <span class="like-icon"><?= $iconUnicodeDislike ?></span>
        <?php endif; ?>
        <?php if ($showCountğŸ–“): ?>
            <span class="dislike-count"><?= (int) $counts['dislikes'] ?></span>
        <?php endif; ?>
    </button>
    <?php endif; ?>
</div>
